@page "/add-question-answer"
@using Blazor_Server.Services
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage
@using System.IdentityModel.Tokens.Jwt
@using static Blazor_Server.Services.ExamService
@inject NavigationManager Navigation
@inject ExamService ExamSer
@inject Notification notification
@layout TeacherLayout
@inject ProtectedSessionStorage SessionStorage

@inject HttpClient Http

<h3>Thêm Câu Hỏi</h3>

@if (!string.IsNullOrEmpty(Message))
{
    <p class="text-success">@Message</p>
}

<div class="mb-3">
    <label class="form-label">Câu hỏi:</label>
    <input type="text" class="form-control" @bind="questionText" />
</div>

@for (int i = 0; i < answers.Count; i++)
{
    <div class="mb-2">
@*         <input type="radio" name="correctAnswer" @bind="@selectedAnswerIndex" value="@i" /> *@
        <input type="text" class="form-control d-inline-block w-75" @bind="answers[i]" placeholder="Nhập đáp án" />
    </div>
}

<button class="btn btn-primary" @onclick="SubmitQuestion">Gửi Câu Hỏi</button>

@code {
    private string questionText = "";
    private List<string> answers = new() { "", "", "", "" };
    private int selectedAnswerIndex = 0;
    private string Message = "";

    private async Task SubmitQuestion()
    {
        var model = new QuestionViewModel
        {
            Question = new Question { Content = questionText },
            Answers = answers.Select((ans, index) => new Answer
            {
                Content = ans,
                IsCorrect = index == selectedAnswerIndex
            }).ToList()
        };

        var response = await Http.PostAsJsonAsync("https://localhost:7187/api/Question/Post", model);
        
        if (response.IsSuccessStatusCode)
        {
            Message = "Câu hỏi đã được thêm thành công!";
            questionText = "";
            answers = new() { "", "", "", "" };
            selectedAnswerIndex = 0;
        }
        else
        {
            Message = "Lỗi khi thêm câu hỏi!";
        }
    }

    public class Question
    {
        public string Content { get; set; }
    }

    public class Answer
    {
        public string Content { get; set; }
        public bool IsCorrect { get; set; }
    }

    public class QuestionViewModel
    {
        public Question Question { get; set; }
        public List<Answer> Answers { get; set; }
    }
}
